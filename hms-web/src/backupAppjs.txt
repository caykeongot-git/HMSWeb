import { useState, useEffect } from 'react'
import axios from 'axios'
import './App.css'
import BookingModal from './BookingModal' // Import Modal

function App() {
  const [rooms, setRooms] = useState([])
  const [filteredRooms, setFilteredRooms] = useState([])
  const [loading, setLoading] = useState(true)
  const [roomTypes, setRoomTypes] = useState([])
  const [selectedType, setSelectedType] = useState('ALL')
  
  // State ƒë·ªÉ qu·∫£n l√Ω Modal
  const [selectedRoom, setSelectedRoom] = useState(null); // Ph√≤ng ƒëang ch·ªçn ƒë·ªÉ ƒë·∫∑t

  // --- L∆ØU √ù: Thay PORT c·ªßa API m√°y c·∫≠u v√†o ƒë√¢y ---
  const API_URL = "http://localhost:5271/api/Room/available"; 

  useEffect(() => {
    const fetchRooms = async () => {
      try {
        const response = await axios.get(API_URL);
        const data = response.data;
        setRooms(data);
        setFilteredRooms(data);
        setLoading(false);
        const types = ['ALL', ...new Set(data.map(room => room.type))];
        setRoomTypes(types);
      } catch (error) {
        console.error("L·ªói g·ªçi API:", error);
        setLoading(false);
      }
    };
    fetchRooms();
  }, []);

  const handleFilterChange = (e) => {
    const type = e.target.value;
    setSelectedType(type);
    if (type === 'ALL') {
      setFilteredRooms(rooms);
    } else {
      const filtered = rooms.filter(room => room.type === type);
      setFilteredRooms(filtered);
    }
  };

  // H√†m m·ªü Modal
  const handleBookClick = (room) => {
    setSelectedRoom(room);
  };

  // H√†m ƒë√≥ng Modal
  const handleCloseModal = () => {
    setSelectedRoom(null);
  };

  return (
    <div className="app-container">
      {/* Navbar gi·∫£ l·∫≠p */}
      <nav className="navbar">
        <div className="logo">MATERIALLY HOTELS</div>
        <ul className="nav-links">
          <li>HOME</li>
          <li>ROOMS & SUITES</li>
          <li>DINING</li>
          <li>SPA</li>
          <li className="active">BOOK NOW</li>
        </ul>
      </nav>

      {/* Hero Banner */}
      <header className="hero">
        <div className="hero-content">
          <p className="subtitle">WELCOME TO PARADISE</p>
          <h1>Luxury & Resort Suites</h1>
          <div className="divider"></div>
          <p className="description">Tr·∫£i nghi·ªám k·ª≥ ngh·ªâ ƒë·∫≥ng c·∫•p th∆∞·ª£ng l∆∞u v·ªõi d·ªãch v·ª• 5 sao chu·∫©n qu·ªëc t·∫ø.</p>
        </div>
      </header>

      {/* Main Content */}
      <div className="content">
        <div className="section-title">
          <h2>Accommodations</h2>
          <p>T√¨m kh√¥ng gian ho√†n h·∫£o cho k·ª≥ ngh·ªâ c·ªßa b·∫°n</p>
          
          {!loading && (
            <div className="filter-container">
              <label className="filter-label">Filter by Room Type:</label>
              <select className="filter-select" value={selectedType} onChange={handleFilterChange}>
                {roomTypes.map((type, index) => (
                  <option key={index} value={type}>
                    {type === 'ALL' ? 'Show All Rooms' : type}
                  </option>
                ))}
              </select>
            </div>
          )}
          <p style={{marginTop: '10px', fontSize: '0.9rem'}}>Hi·ªÉn th·ªã {filteredRooms.length} ph√≤ng tr·ªëng</p>
        </div>
        
        {loading ? (
          <div className="loading-container">
            <div className="spinner"></div>
            <p>ƒêang t√¨m ph√≤ng t·ªët nh·∫•t cho b·∫°n...</p>
          </div>
        ) : (
          <div className="room-grid">
            {filteredRooms.map((room) => (
              <div key={room.id} className="room-card">
                <div className="room-image-wrapper">
                  <img src={`https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=800&q=80&sig=${room.id}`} alt="Hotel Room" />
                  <div className="price-badge">
                    <span className="currency">VND</span>
                    <span className="amount">{room.price.toLocaleString()}</span>
                    <span className="period">/ Night</span>
                  </div>
                </div>
                
                <div className="room-details">
                  <span className="room-type">{room.type}</span>
                  <h3 className="room-number">Room {room.roomNumber}</h3>
                  <div className="room-features">
                    <span>üë• {room.capacity} Guests</span>
                    <span>üìê 45m¬≤</span>
                    <span>üì∂ Free Wifi</span>
                  </div>
                  <div className="card-footer">
                    <button className="btn-detail">DETAILS</button>
                    {/* S·ª∞ KI·ªÜN CLICK M·ªöI */}
                    <button className="btn-book" onClick={() => handleBookClick(room)}>
                      BOOK NOW
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Footer */}
      <footer className="footer">
        <div className="footer-content">
          <h3>MATERIALLY HOTEL</h3>
          <p>123 Beach Road, Danang City, Vietnam</p>
          <p>Hotline: (+84) 909 123 456</p>
          <p className="copyright">¬© 2026 Materially Hotel Group. All rights reserved.</p>
        </div>
      </footer>

      {/* HI·ªÇN TH·ªä MODAL N·∫æU C√ì PH√íNG ƒê∆Ø·ª¢C CH·ªåN */}
      {selectedRoom && (
        <BookingModal room={selectedRoom} onClose={handleCloseModal} />
      )}
    </div>
  )
}

export default App